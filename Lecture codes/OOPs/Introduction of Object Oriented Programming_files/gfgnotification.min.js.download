/* JS Version 1.1*/
var gfgNotificationsApiUrl=gfgObject.gfgNotificationsApiUrl;jQuery(document).ready((function(){let i,t="latest",n=10,a=!1;const o=document.querySelector(".notification-modal-scroll");let e,c,s=!1,l=0,r=0,d=0,f=0,u="",m=0,h=window.innerHeight,p={all:[],read:[],unread:[]},g={all:1,read:1,unread:1},v={all:1,read:1,unread:1};function _(i){var t=new Date(i),n=(new Date-t)/1e3;if(n<60)return"now";if(n<3600)return`${Math.floor(n/60)} min ago`;if(n<7200)return"1 hour ago";if(n<86400){var a=Math.floor(n/3600);return 1===a?"1 hour ago":`${a} hours ago`}return n<172800?"1 day ago":`${Math.floor(n/86400)} days ago`}function y(i,t=3e3){const n=$(`\n            <div class="toast-message" style="\n                min-width: 200px;\n                background-color: #333;\n                color: #fff;\n                padding: 10px 20px;\n                margin-top: 10px;\n                border-radius: 5px;\n                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n                font-family: Arial, sans-serif;\n            ">\n                ${i}\n            </div>\n     `);$("#toast-container").append(n),setTimeout((()=>{n.fadeOut(500,(()=>{n.remove()}))}),t)}function b(i,t="all",a){return $(".notification-modal").show(),new Promise(((o,e)=>{if(i=parseInt(i,10),isNaN(i)||i<=0)return void e("Invalid page number");const s=$(".notification-modal-scroll");p[t]||(p[t]=[]);let d=`${gfgNotificationsApiUrl}push-notification/user/list/?page=${i}`;"read"!==t&&"unread"!==t||(d+=`&filter=${t}`),$.ajax({url:d,method:"GET",xhrFields:{withCredentials:!0},success:function(e){let s=e.result,d=e.unread;c=e.total,r=c-d,l=e.unread,d>0?d>99?$(".notification-count").text("99+").show():$(".notification-count").text(d).show():$(".notification-count").hide(),g.read=Math.ceil(r/n),g.unread=Math.ceil(d/n),g.all=Math.ceil(c/n);const f=s.filter((i=>!p[t].some((t=>t.id===i.id))));p[t]=p[t].concat(f),$(".loader_modal").hide(),w(f,t,a,i),o()},error:function(i){$(".loader_modal").hide(),s.html("<div class='notification-icon empty-icon .empty-icon '></div><p class=\"empty_notifications\">Something went wrong!!</p>"),e()}})}))}function w(t,n,a,o){const e=$(".notification-modal-scroll");"latest"===a?t.sort(((i,t)=>new Date(t.created_at)-new Date(i.created_at))):"oldest"===a&&t.sort(((i,t)=>new Date(i.created_at)-new Date(t.created_at))),t.forEach((t=>{const n=function(t){const n=_(t.created_at),a=t.meta.notification.imageUrl||"https://media.geeksforgeeks.org/img-practice/prod/generic/1/Web/Content/hello%201_1705399555.svg";return`\n            <a href="${t.meta.data.redirection_url}" target="_blank" class="notification-content ${1===t.status&&"read"!==i?"unread_notification":""}" data-id="${t.id}" data-link="${t.meta.data.redirection_url}">\n                <div class="image_container">\n                    <img class="user-icon" src="${a}" alt="User Icon"/>\n                </div>\n                <div class="notification-content-box">\n                    <h4 class="notification_title"><b>${t.meta.notification.title}</b></h4>\n                    <p class="notification_description truncate-two-lines">${t.meta.notification.description}</p>\n                    <span class="timestamp">${n}</span>\n                </div>\n            </a>\n        `}(t);e.append(n)})),0===c&&"all"===n&&1===o&&e.html("<div class='notification-icon empty-icon .empty-icon '></div><p class=\"empty_notifications\">You're all caught up!!</p>"),0===t.length&&1===o&&"all"!==n&&e.html("<div class='notification-icon empty-icon .empty-icon '></div><p class=\"empty_notifications\">You're all caught up!!</p>"),$(".loader_modal").hide()}$(document).on("click",".notification-content_container,.notification-content",(function(){const n=$(this).hasClass("unread_notification"),a=$(this).data("id"),o={id:a,meta:{data:{redirection_url:$(this).data("link")}}};a&&o.meta.data.redirection_url&&function(n,a){const o=n.id,e=n.meta.data.redirection_url;e?window.open(e,"_blank"):y("Redirection URL is not available.");if(a){const n={origin:"web",id:o,status:2};$.ajax({url:`${gfgNotificationsApiUrl}push-notification/user/update/`,method:"PATCH",xhrFields:{withCredentials:!0},contentType:"application/json",data:JSON.stringify(n),success:function(n){l--,fetchUnreadNotificationCount();if($(`[data-id="${o}"]`).removeClass("unread_notification"),"read"!==i&&(function(i){const t=p.unread.findIndex((t=>t.id===i));if(-1!==t){const i=p.unread.splice(t,1)[0];p.read.length>0&&p.read.push(i)}const n=p.all.findIndex((t=>t.id===i));-1!==n&&(p.all[n].status=2,delete p.all[n].unread_class)}(o),"unread"==i)){$(".notification-modal-scroll").empty(),w(p.unread,i,t,v[i])}},error:function(i){}})}}(o,n)})),$(document).mouseup((function(i){var t=$("#notification"),n=$("#notification-bell-icon");t.is(i.target)||0!==t.has(i.target).length||n.is(i.target)||0!==n.has(i.target).length||t.hide()})),$("#all-notifications-inner").click((function(i){i.preventDefault(),i.stopPropagation()})),$("#notification-bell-icon, .notification-count").click((function(){if(!$(".notification-modal-content").is(":visible"))if(i="all",loginData.isLoggedIn){var a=$(window).width(),o=$("#notification");if(a>768){if($("#all-notifications-inner").addClass("active-category"),$("#notification").removeClass("notification_hide"),o.is(":visible"))return void o.hide();o.show(),function(i){$("#all-notifications").addClass("active");const t=$(".notification-scroll");$.ajax({url:`${gfgNotificationsApiUrl}push-notification/user/list/?page=1`,method:"GET",xhrFields:{withCredentials:!0},success:function(t){e=t.unread,c=t.total,r=c-e;let a=t.result;const o=$(".notification-scroll");l=t.unread,g.read=Math.ceil(r/n),g.unread=Math.ceil(e/n),g.all=Math.ceil(c/n),e>0?e>99?$(".notification-count").text("99+").show():$(".notification-count").text(e).show():$(".notification-count").hide(),$("#all-notifications-inner").html(`All <div class='notification_count'>${t.total>99?"99+":t.total}</div>`),"read"===i?a=a.filter((i=>null!==i.read_time)):"unread"===i&&(a=a.filter((i=>null===i.read_time))),a.sort(((i,t)=>new Date(t.created_at)-new Date(i.created_at)));const d=a.slice(0,5);p[i]=a,o.empty(),0===a.length?($(".notification-footer").css("visibility","hidden"),o.html("<div class='notification-icon empty-icon .empty-icon '></div><p class=\"empty_notifications\">You're all caught up!!</p>")):($(".notification-footer").css("visibility","visible"),d.forEach((i=>{let t=i.meta.notification.description;const n=i.meta.notification.imageUrl||"https://media.geeksforgeeks.org/img-practice/prod/generic/1/Web/Content/hello%201_1705399555.svg",a=_(i.created_at),e=`\n                            <a href="${i.meta.data.redirection_url}" target="_blank" class="notification-content ${1===i.status?"unread_notification":""} " data-id="${i.id}" data-link="${i.meta.data.redirection_url}">\n                                <div class="image_container">\n                                    <img class="user-icon" src="${n}" alt="User Icon"/>\n                                </div>\n                                <div class="notification-content-box">\n                                    <h4 class="notification_box_title">\n                                        <b>${i.meta.notification.title}</b>\n                                    </h4>\n                                    <p class="notification_box_description truncate-two-lines">${t}</p>\n                                    <span class="notification_box_timestamp">${a}</span>\n                                </div>\n                            </a>\n                        `;o.append(e)}))),s=!0,$("#loader").hide()},error:function(i){s=!0,$("#loader").hide(),$(".notification-footer").css("visibility","hidden"),t.html("<div class='notification-icon empty-icon .empty-icon '></div><p class=\"empty_notifications\">Something went wrong!!</p>")}})}(i),s||$("#loader").show()}else $(".notification_categories-inner-container").removeClass("active-category"),$("#all-notifications-modal").addClass("active-category"),$(".notification-category").removeClass("active"),$("#all-notifications-modal").addClass("active"),$("#notification").addClass("notification_hide"),$("body").addClass("no-scroll"),b(v[i],i,t)}else $(".header-main__wrapper").find(".header-main__signup.login-modal-btn").length&&$(".header-main__wrapper").find(".header-main__signup.login-modal-btn").click()})),$("#view-all").click((function(){event.stopPropagation(),$("#notification").hide(),i="all",t="latest",$(".notification-category").removeClass("active"),$("#all-notifications-modal").addClass("active"),$("#notification").addClass("notification_hide"),$(".notification_close_button").hasClass("gfg-icon")||$(".notification_close_button").addClass("gfg-icon"),$("body").addClass("no-scroll"),$(".loader_modal").show(),$(".notification_categories-inner-container").removeClass("active-category"),$("#all-notifications-modal").addClass("active-category"),$(".notification-modal").show(),$("#all-notifications-inner-modal").html(`All <div class='notification_count'>${c>99?"99+":c}</div>`),w(p[i],i,t,v),h>1129&&c>10&&(v[i]++,b(v[i],i,t)),o.scrollTop=0})),$("#notification_close_button").click((function(){$("#notification-modal").hide(),$("body").removeClass("no-scroll"),Object.keys(g).forEach((i=>g[i]=1)),Object.keys(v).forEach((i=>v[i]=1)),Object.keys(p).forEach((i=>p[i]=[])),a=!0;$(".notification-modal-scroll").empty()})),$(".mark_all_read").click((function(){var t=$(this);l<1||t.prop("disabled")||(t.prop("disabled",!0),$.ajax({url:`${gfgNotificationsApiUrl}push-notification/user/read-all/`,method:"PUT",xhrFields:{withCredentials:!0},data:{origin:"web"},success:function(t){if(l=0,$(".mark_all_read").addClass("hidden"),$(".notification-count").hide(),p.all.forEach((i=>{const t=$(`[data-id="${i.id}"]`);t.hasClass("unread_notification")&&(t.removeClass("unread_notification").addClass("read_notification read-color"),i.status=2,delete i.unread_class),p.read.some((t=>t.id===i.id))||p.read.push(i)})),p.unread=[],"unread"===i){const i=$(".notification-modal-scroll");i.empty(),i.html("<div class='notification-icon empty-icon .empty-icon '></div><p class=\"empty_notifications\">You're all caught up!!</p>")}},error:function(i){y("Error marking notifications as read."),t.prop("disabled",!1)},complete:function(){t.prop("disabled",!1)}}))})),$(".notification_categories-inner-container").on("click",(function(){$(".notification_categories-inner-container").removeClass("active-category"),$(this).addClass("active-category")})),o.addEventListener("scroll",(()=>{const n=o.scrollTop;n>m&&(a=!1,Math.ceil(o.scrollTop+o.clientHeight)>=o.scrollHeight&&!a&&v[i]<g[i]&&(a=!0,v[i]++,b(v[i],i,t).then((()=>{a=!1})).catch((()=>{a=!1})))),m=n})),$(".notification-category").click((function(){if($(this).hasClass("active"))return;$(".notification-category").removeClass("active"),$(this).addClass("active"),i=$(this).attr("id").replace("-notifications-modal","");const n=$(".notification-modal-scroll");if(n.empty(),p[i].length)return clearTimeout(u),void(u=setTimeout((function(){n.append(w(p[i],i,t,v[i]))}),100));"unread"===i&&0===l&&1==d||"read"===i&&0===r&&1==f?n.html("<div class='notification-icon empty-icon .empty-icon '></div><p class=\"empty_notifications\">You're all caught up!!</p>"):(b(v[i],i,t),(h>1129&&"read"==i&&r>10&&1==v[i]||h>1129&&"unread"==i&&l>10&&1==v[i])&&(v[i]++,b(v[i],i,t))),"unread"===i?d=1:"read"===i&&(f=1)}))})),$(document).ready((function(){$(".notification-header").removeClass("hidden"),$(".notification-category_container").removeClass("hidden"),$(".notification-modal-content-header").removeClass("hidden"),$(".zero_notification_content").removeClass("hidden"),$("#view-all").removeClass("hidden")}));